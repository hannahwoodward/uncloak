var uncloak=function(){"use strict";function d(t,e,i){t.removeAttribute("data-uncloak-new"),this.callbacks=i.callbacks||{init:[],uncloak:[]},this.cloaked=!0,this.uncloakReady=!1,this.delayTimer={y0:0,y1:null},this.delayType=t.getAttribute("data-uncloak-delay-type")||null,this.delayTypes=i.delayTypes||{},this.instance=e,this.lazyContent=t.hasAttribute("data-uncloak-ignore-lazy")?[]:t.querySelectorAll("[data-uncloak-src], [data-uncloak-srcset]"),this.lazyContentLoadStatus=this.lazyContent[0]?-1:2,this.node=t,this.threshold=parseFloat(t.getAttribute("data-uncloak-threshold"))||0,this.lazyContentObserver=null}d.prototype.init=function(){var e=this;this.lazyContent[0]&&(this.lazyContentObserver=new IntersectionObserver(function(t){t[0].isIntersecting&&(e.loadLazyContent(),e.lazyContentObserver.disconnect())},{rootMargin:"50%"}),this.lazyContentObserver.observe(this.node)),this.runCallbacks("init")},d.prototype.process=function(t){return this.cloaked&&(null!==this.delayType&&null===this.delayTimer.y1&&(this.delayTimer={y0:performance.now(),y1:this.createDelayTimeout(t,this.delayType)},t++),this.imagesLoaded()?this.uncloak():this.uncloakReady=!0),t},d.prototype.uncloak=function(){var t=this;if(this.cloaked){this.cloaked=!1;var e=performance.now()-this.delayTimer.y0,i=this.delayTimer.y1-e,o=function(){t.node.classList.remove("uncloak--cloaked"),t.runCallbacks("uncloak")};i<=0?o():setTimeout(o,i)}},d.prototype.reset=function(t){void 0===t&&(t=!0),this.cloaked=!0,this.delayTimer={y0:0,y1:null},this.node.classList.add("uncloak--cloaked"),t&&this.instance.nodeObserver.observe(this.node)},d.prototype.runCallbacks=function(t){var e=this.callbacks[t];if(e&&e.length)for(var i=0;i<e.length;i++)e[i](this)},d.prototype.createDelayTimeout=function(t,e){return this.delayTypes&&this.delayTypes[e](t)||0},d.prototype.loadLazyContent=function(){var e=this;if(!this.imagesLoaded()&&1!==this.lazyContentLoadStatus){this.lazyContentLoadStatus=1;for(var i=this.lazyContent.length,o=function(t){return function(){t.removeEventListener("load",o,!1),t.removeAttribute("data-uncloak-src"),t.removeAttribute("data-uncloak-srcset"),0===(i-=1)&&(e.lazyContentLoadStatus=2,e.uncloakReady&&e.uncloak())}},t=0;t<this.lazyContent.length;t++){var n=this.lazyContent[t],s=n.getAttribute("data-uncloak-srcset")||null;s&&(n.srcset=s),n.src=n.getAttribute("data-uncloak-src"),n.addEventListener("load",o(n),!1)}}},d.prototype.imagesLoaded=function(){return 2===this.lazyContentLoadStatus};function a(t,e){this.container=t.container,this.video=t.video||t.container.querySelector("video"),this.promise=null,this.loadStatus=0,this.error=!1,this.requiresResize=this.container.hasAttribute("data-video-resize"),this.autoplay=t.autoplay||0,this.callbacks={durationchange:[],firstPlay:[],playing:[],error:[]},e&&this.init()}a.prototype.init=function(){var t=this;if(!(0<this.loadStatus)){this.loadStatus=1,this.video.src||(this.video.src=this.video.getAttribute("data-src"),this.video.removeAttribute("data-src")),this.video.addEventListener("loadedmetadata",function(){t.video.currentTime=.1,t.requiresResize&&t.resizeVideo()},!1),this.video.addEventListener("durationchange",function(){t.loadStatus=2,t.video.setAttribute("muted",""),t.runCallbacks("durationchange"),t.autoplay&&t.play()},!1);var e=function(){t.container.classList.add("video-loaded"),t.runCallbacks("firstPlay"),t.video.removeEventListener("playing",e,!1)};this.video.addEventListener("playing",e,!1),this.video.addEventListener("playing",function(){t.runCallbacks("playing")},!1),this.video.addEventListener("error",function(){t.disable()},!1)}},a.prototype.play=function(){var t=this;if(!this.isLoading()&&this.video.paused&&null===this.promise){0===this.loadStatus&&this.init();var e=this.video.play();void 0!==e&&(this.promise=e).then(function(){t.promise=null}).catch(function(){t.promise.status&&"rejected"===t.promise.status&&t.disable()}),setTimeout(function(){t.video.paused&&t.disable()},100)}},a.prototype.disable=function(){this.container.classList.add("video-disabled"),this.error=!0,this.runCallbacks("error")},a.prototype.pause=function(){this.pauseReady()&&this.video.pause()},a.prototype.reset=function(){this.pauseReady()&&(this.video.pause(),this.video.currentTime=.1)},a.prototype.pauseReady=function(){return!this.video.paused&&null===this.promise&&2===this.loadStatus},a.prototype.addCallback=function(t,e){this.callbacks[t].push(e)},a.prototype.runCallbacks=function(t){var e=this.callbacks[t];if(e.length)for(var i=0;i<e.length;i++)e[i]()},a.prototype.isDisabled=function(){return this.error},a.prototype.isPaused=function(){return this.video.paused},a.prototype.isLoaded=function(){return 2===this.loadStatus},a.prototype.isLoading=function(){return 1===this.loadStatus},a.prototype.resizeVideo=function(){if(this.video.videoHeight/this.video.videoWidth<=this.container.offsetHeight/this.container.offsetWidth)return this.video.style.height="100%",void(this.video.style.width="auto");this.video.style.height="auto",this.video.style.width="100%"};function t(t){if(this.items=[],this.hasResizeListener=!1,this.nodeObserver=null,this.itemOptions={delayTypes:{},callbacks:{}},t&&t.itemOptions)for(var e in this.itemOptions)t.itemOptions[e]&&(this.itemOptions[e]=t.itemOptions[e]||{});this.init()}var h=function(s){function t(t,e,i){var o=this;if(s.call(this,t,e,i),this.videoPlayer=null,void 0!==a){var n=t.querySelector("."+t.getAttribute("data-uncloak-video"));this.videoPlayer=new a({container:n,autoplay:0},!1),this.videoPlayer.addCallback("firstPlay",function(){o.uncloak()}),this.videoPlayer.addCallback("error",function(){o.loadLazyContent(),o.uncloak()})}}return s&&(t.__proto__=s),((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.init=function(){var i=this;this.lazyContentObserver=new IntersectionObserver(function(t){var e=t[0];i.videoPlayer.isDisabled()?(i.loadLazyContent(),i.lazyContentObserver.disconnect()):i.toggleVideoPlay(e.isIntersecting)},{rootMargin:"10%"}),this.lazyContentObserver.observe(this.videoPlayer.container),this.runCallbacks("init")},t.prototype.toggleVideoPlay=function(t){t?this.videoPlayer.play():this.videoPlayer.pause()},t}(d);return t.prototype.init=function(){var l=this;"IntersectionObserver"in window||console.error("uncloak: IntersectionObserver not supported in this browser."),this.nodeObserver=new IntersectionObserver(function(t){for(var e=0,i=0;i<t.length;i++){var o=t[i].boundingClientRect,n=t[i].isIntersecting||o.top<=0&&o.left<=0&&o.width>=document.body.clientWidth&&o.height>=window.innerHeight;if(n){var s=l.getItemByNode(t[i].target),a=o.height,r=s.threshold*t[i].rootBounds.height;(r<=a?t[i].intersectionRect.height>=r:n)&&(e=s.process(e),l.nodeObserver.unobserve(t[i].target))}}},{rootMargin:"10% 0%",threshold:[.1,.2,.3,.5,.6,.7,.8,.9]}),this.findNewItems()},t.prototype.findNewItems=function(t){var e=this;if(void 0===t&&(t=document.querySelectorAll("[data-uncloak-new]")),t[0]){for(var i=this.items.length,o=!1,n=0;n<t.length;n++){var s=t[n],a=i+n,r=void 0;s.hasAttribute("data-uncloak-video")?(r=new h(s,this,this.itemOptions),o=!0):r=new d(s,this,this.itemOptions),s.id="uncloak-"+a,r.init(),this.nodeObserver.observe(s),this.items.push(r)}if(o&&!this.hasResizeListener){this.hasResizeListener=!0;var l=function(){for(var t=0;t<e.items.length;t++)"videoPlayer"in e.items[t]&&(e.items[t].videoPlayer.isResponsive&&e.items[t].videoPlayer.setSrc(),e.items[t].videoPlayer.requiresResize&&e.items[t].videoPlayer.resizeVideo())};window.addEventListener("orientationchange",l),window.addEventListener("resize",l)}}},t.prototype.getItemByNode=function(t){var e=t.id.split("-")[1];return this.items[e]},t}();
